(function(){var t,n=function(n,t){return function(){return n.apply(t,arguments)}};window.VideoPlayer=t=function(){function t(i,r){var f,e,u=this;this.container=i,this.createEventHandler=n(this.createEventHandler,this),this.attach=n(this.attach,this),this.detach=n(this.detach,this),this.setPoster=n(this.setPoster,this),this.setSource=n(this.setSource,this),this.setLanguage=n(this.setLanguage,this),this.updateLanguage=n(this.updateLanguage,this),r&&(this.src=r.src),this.currentLang=r&&r.lang?r.lang:"en",r&&(this.poster=r.poster),r&&(this.onFullscreen=r.onFullscreen),r&&(this.offFullscreen=r.offFullscreen),this.playing=!1,this.isFullScreen=!1,this.videoControls=$("<div>").addClass("video-controls"),this.playButton=$("<input type='button' class='button play-button'>").html("").bind("click",function(){return u.play()}),this.progressBar=$("<p class='progress-bar'>"),this.srtButton=$("<input type='button' class='button subtitles-button'/>").bind("click",function(){return u.srtButton.toggleClass("off"),u.container.find(".videosub-bar").toggle()}),f=$("<div class='video-controls-buttons'/>").append(this.playButton).append(this.srtButton),e=$("<div class='progress-div'>").append(this.progressBar),this.eventsToUse=navigator.userAgent.match(/Android/i)||t.is_touch_device()?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup"],this.initVideoProgress().append(e),this.initVolumeControls(),this.videoControls.append(f).append(this.progressContainer).append(this.volumeControls),this.track=$("<track/>"),this.videoElement=$("<video webkit-playsinline>").addClass("video-element").bind("durationchange",function(){return u.duration=u.videoElement[0].duration}).bind("timeupdate",function(){var t,i,r,f,e,n;return n=Math.floor(u.videoElement[0].currentTime),t=Math.floor(n/60),i=t<10?"0":"",n%=60,f=n<10?"0":"",e=""+(i+t.toString())+":"+(f+n.toString()),u.timeSpan.text(e),r=(u.videoElement[0].currentTime/u.duration*100).toFixed(2),u.progressBar.css({width:r+"%"}),!1}).bind("ended",function(){return u.playButton.removeClass("paused"),u.playing=!1,!1}).append(this.track),this.poster!=null&&this.setPoster(this.poster),this.tightContainer=$("<div>").addClass("tight-container").append(this.videoElement).append(this.videoControls).height(200),this.container.addClass("video-container").append(this.tightContainer),this.src!=null&&this.setSource(this.src)}return t.prototype.beforeChangeStyle={},t.prototype.updateLanguage=function(){var n;return this.srt=this.src.replace(".mp4","-"+this.currentLang+".vtt"),this.track.attr({"default":"default",kind:"subtitles",src:this.srt,srclang:this.currentLang,label:this.currentLang}),this.videoElement.detach(),this.tightContainer.prepend(this.videoElement),this.container.find(".videosub-container").remove(),this.container.find(".videosub-bar").remove(),this.videoElement.videoSub(),n=this.container.find(".videosub-bar").css({padding:"0",width:"100%",left:0}).detach(),this.tightContainer.append(n),null},t.prototype.setLanguage=function(n){return this.currentLang=n,this.updateLanguage(),null},t.prototype.setSource=function(n){return this.src=n,this.videoElement.attr({src:this.src,type:"video/mp4"}),this.updateLanguage(),null},t.prototype.setPoster=function(n){return this.videoElement.attr({poster:n}),null},t.prototype.detach=function(){return this.tightContainer.detach(),!0},t.prototype.attach=function(){return this.container.append(this.tightContainer)},t.prototype.createEventHandler=function(n,t){var i=this;return function(r){var u,f,e;return f="page"+(i.isFullScreen?"Y":"X"),e=i.isFullScreen?"top":"left",r.originalEvent.touches!=null?u=(r.originalEvent.touches[0][f]-n.offset()[e])/n.width():r.originalEvent.pageX!=null&&(u=(r.originalEvent[f]-n.offset()[e])/n.width()),u=u>1?1:u<0?0:u,t(u),r.preventDefault(),r.stopPropagation(),!1}},t.prototype.initVolumeControls=function(){var n=this;return this.volumeControls=$("<div class='volume-controls'>"),this.timeSpan=$("<div class='time-div'>00:00<\/div>"),this.fullScreenButton=$("<input type='button' class='button fullscreen-button'>").html("").click(function(){return n.enterFullScreenMode()}),this.volumeControls.append(this.timeSpan.append(this.fullScreenButton))},t.prototype.initVideoProgress=function(){var n,t=this;return this.progressContainer=$("<div class='progress-container'>"),n=this.createEventHandler(this.progressContainer,function(n){var i;return i=(t.videoElement[0].duration*n).toFixed(0),t.videoElement[0].currentTime=i,null}),this.progressContainer.bind(this.eventsToUse[0],n),this.progressContainer.bind(this.eventsToUse[1],n)},t.saveStyle=function(n,t,i){return n.width=t.css("width"),n.height=t.css("height"),n.position=t.css("position"),i?void 0:n.tlbr={top:t.css("top"),left:t.css("left"),bottom:t.css("bottom"),right:t.css("right")}},t.is_touch_device=function(){return"ontouchstart"in window||"onmsgesturechange"in window},t.restoreStyle=function(n,t){return n.css("width",t.width),n.css("height",t.height),n.css("position",t.position)},t.stretch=function(n){return n.css({width:window.innerHeight,height:window.innerWidth,position:"absolute",top:0,left:0}),n.addClass("stretched")},t.prototype.enterFullScreenMode=function(){return this.fullScreenButton.toggleClass("un"),this.isFullScreen?(this.isFullScreen=!1,t.restoreStyle(this.tightContainer,this.beforeChangeStyle.tc),this.tightContainer.removeClass("stretched"),this.offFullscreen&&this.offFullscreen()):(this.isFullScreen=!0,this.beforeChangeStyle.tc={},t.saveStyle(this.beforeChangeStyle.tc,this.tightContainer,!0),t.stretch(this.tightContainer),this.onFullscreen&&this.onFullscreen()),null},t.prototype.play=function(){return this.playButton.toggleClass("paused"),this.playing?(this.playing=!1,this.videoElement[0].pause()):(this.playing=!0,this.videoElement[0].play())},t}()}).call(this)